---
layout: post
tagline:  ""
title: "Декодирование SMS PDU на PHP"
date:   2014-11-24 15:00:00
category: posts
tags : [PHP,ScriptFu]
wordpress_id : 1003
---

Работая с устройством оборудованным GSM-модемом, понадобилось реализовать функционал чтения присылаемых СМС-сообщений. 
В процессе, получил написанный на PHP объект, умеющий декодировать данные представленные в PDU формате.


СМСки из памяти модема можно достать в двух вариантах: в текстовом виде и в формате PDU. Первый вариант подходит только для сообщений на латинице. То есть, кто пишет на кириллице -- в пролёте. И text mode вариант сразу же отпадает. По этому работать нужно в PDU режиме.

Встал вопрос как PDU декодировать в нормальный вид. Я нашел подробное описание формата: http://web.archive.org/web/20121104191455/http://www.dreamfabric.com/sms/

Но реализовывать весь функционал с нуля мне показалось излишним. Я понадеялся, что кто-то уже за меня эту работу уже сделал. Как же я ошибался, найти с ходу готовые библиотеки на PHP, Perl или ещё чём-то интерпретируемом не получилось.

К счастью, в одном англоязычном блоге, [Nicholas Skinner](http://www.ns-tech.co.uk/) , я нашел неплохую реализацию на PHP объекта декодирующего PDU: http://www.ns-tech.co.uk/blog/2013/05/8-bit-sms-pdu-decoding-via-php/.

К несчастью, оказалось, что объект оказался для меня не функционален: 

+ не декодировал поле TP-SCTS (time stamp);
+ номер отправителя мог быть только числовым, не поддерживались короткие и буквенные номера;
+ не поддерживалась 7bit ASCII кодировка сообщений;
+ И самое важное -- не поддерживалась UCS2 кодировка сообщений, и как следствие кириллические сообщения (и любые другие отличные от латиницы) декодировать он не умел. 

В прочем, упрекать Николаса считаю излишним -- ему сообщения на кириллице разбирать не приходилось. Дописать необходимый функционал самому, но это куда проще, чем писать всё с нуля.

В итоге, с разрешения Николаса, публикую здесь доработанную версию его библиотеки, так сказать, с блекджеком и кириллицей. 

Download: [PHP SMS PDU Decoder](/files/sms_pdu_decode.php)